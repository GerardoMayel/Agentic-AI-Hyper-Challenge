# Render Deployment Guide

## Overview
This guide provides step-by-step instructions for deploying the Claims Management System to Render.

## Prerequisites
- GitHub repository with the application code
- Render account
- Environment variables configured

## Files Updated for Render Deployment

### 1. `requirements.txt`
- Updated Reflex to version 0.7.14
- Organized dependencies for better compatibility
- Removed duplicate entries

### 2. `render.yaml`
- Configured for Python 3.11.0
- Set up PostgreSQL database connection
- Configured environment variables
- Added proper build and start commands

### 3. `rxconfig.py`
- Updated to handle Render PostgreSQL URL format
- Configured for production environment
- Added Zurich Insurance color palette
- Set proper backend host configuration

### 4. `app/core/database.py`
- Added PostgreSQL URL format handling
- Updated for production database connection
- Added proper session management

### 5. `.python-version` and `runtime.txt`
- Specified Python 3.11.0 for consistency

## Deployment Steps

### Step 1: Prepare Your Repository
1. Ensure all changes are committed to GitHub
2. Verify the repository is public or connected to Render

### Step 2: Connect to Render
1. Go to [Render Dashboard](https://dashboard.render.com)
2. Click "New +" and select "Web Service"
3. Connect your GitHub repository
4. Select the repository containing this application

### Step 3: Configure the Service
1. **Name**: `claims-management-system`
2. **Environment**: `Python`
3. **Build Command**: 
   ```
   pip install -r requirements.txt
   reflex init --no-open
   ```
4. **Start Command**: 
   ```
   reflex run --env prod --app app.app:app --host 0.0.0.0 --port $PORT
   ```

### Step 4: Set Environment Variables
In the Render dashboard, add these environment variables:

#### Required Variables:
- `ENVIRONMENT`: `production`
- `GEMINI_API_KEY`: Your Gemini API key
- `GOOGLE_CLOUD_PROJECT_ID`: Your Google Cloud project ID
- `GOOGLE_CLOUD_BUCKET_NAME`: Your Google Cloud Storage bucket name
- `GOOGLE_APPLICATION_CREDENTIALS_JSON`: Your Google Cloud service account JSON
- `GMAIL_CREDENTIALS_JSON`: Your Gmail API credentials JSON
- `GMAIL_TOKEN_JSON`: Your Gmail API token JSON

#### Auto-configured Variables:
- `DATABASE_URL`: Automatically set by Render
- `SECRET_KEY`: Automatically generated by Render
- `LOGLEVEL`: Set to `info`

### Step 5: Create Database
1. In Render dashboard, go to "Databases"
2. Create a new PostgreSQL database
3. Name: `claims-db`
4. Plan: Free
5. Connect it to your web service

### Step 6: Deploy
1. Click "Create Web Service"
2. Wait for the build to complete
3. Monitor the logs for any errors

### Step 7: Initialize Database
After successful deployment:
1. Go to your service logs
2. Run the post-deploy script:
   ```bash
   python post_deploy.py
   ```
3. Verify database tables are created

## Verification Steps

### 1. Check Application Health
- Visit your application URL
- Verify the main page loads
- Test the claim form: `/claim-form/`

### 2. Test Database Connection
- Check logs for database connection messages
- Verify tables are created successfully

### 3. Test Email Processing
- Send a test email to: `gerardo_mayel_fernandez_alamilla@chiefdataaiofficer.com`
- Include "claim" in the subject or body
- Verify the claim is processed

## Troubleshooting

### Common Issues:

#### 1. Build Failures
- Check Python version compatibility
- Verify all dependencies in requirements.txt
- Check for syntax errors in code

#### 2. Database Connection Issues
- Verify DATABASE_URL is correctly set
- Check PostgreSQL service is running
- Verify database credentials

#### 3. Environment Variable Issues
- Ensure all required variables are set
- Check variable names match exactly
- Verify JSON credentials are properly formatted

#### 4. Application Startup Issues
- Check logs for specific error messages
- Verify port configuration
- Check Reflex configuration

### Debug Commands:
```bash
# Check application status
curl -I https://your-app.onrender.com

# Test database connection
python -c "from app.core.database import test_connection; test_connection()"

# Check environment variables
python -c "import os; print([k for k in os.environ.keys() if 'DATABASE' in k])"
```

## Post-Deployment

### 1. Monitor Logs
- Regularly check application logs
- Monitor database performance
- Watch for email processing errors

### 2. Set Up Monitoring
- Configure health checks
- Set up error notifications
- Monitor resource usage

### 3. Backup Strategy
- Enable automatic database backups
- Test restore procedures
- Document recovery processes

## Security Considerations

### 1. Environment Variables
- Never commit sensitive data to Git
- Use Render's secure environment variable storage
- Rotate API keys regularly

### 2. Database Security
- Use strong passwords
- Enable SSL connections
- Restrict database access

### 3. Application Security
- Enable HTTPS
- Configure CORS properly
- Validate all inputs

## Support

If you encounter issues:
1. Check the Render documentation
2. Review application logs
3. Verify configuration files
4. Test locally first

## URLs After Deployment

- **Main Application**: `https://claims-management-system.onrender.com`
- **Claim Form**: `https://claims-management-system.onrender.com/claim-form/`
- **Dashboard**: `https://claims-management-system.onrender.com/dashboard`

---

**Note**: This deployment guide assumes you have already set up all the required services (Gmail API, Google Cloud Storage, etc.) as described in the main documentation. 